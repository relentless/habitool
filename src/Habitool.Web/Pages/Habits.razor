@page "/habits"
@namespace Habitool.Web.Pages
@inject HttpClient Http
@inject Microsoft.JSInterop.IJSRuntime JS

<h3>Habits</h3>

@if (!string.IsNullOrEmpty(errorMessage))
{
    <div class="alert alert-danger">@errorMessage</div>
}
else if (habits is null)
{
    <p><em>Loading...</em></p>
}
else if (habits.Length == 0)
{
    <p>No habits found.</p>
}
else
{
    <ul>
        @foreach (var habit in habits)
        {
            <li>@habit.Title - @habit.Description</li>
        }
    </ul>
}

@code {
    Habit[]? habits;
    string? errorMessage;

    protected override async Task OnInitializedAsync()
    {
        try
        {
            habits = await Http.GetFromJsonAsync<Habit[]>("/api/habits");
        }
        catch (Exception ex)
        {
            errorMessage = "An error occurred while loading habits. See console for details.";
            await JS.InvokeVoidAsync("console.error", ex.ToString());
        }
    }

    private class Habit
    {
        public int Id { get; set; }
        public string? Title { get; set; }
        public string? Description { get; set; }
    }
}